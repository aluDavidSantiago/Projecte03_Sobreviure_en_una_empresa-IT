# 3. Tareas de Implementación y Configuración del Servidor LDAP

La Consultora **EverPia** debe cumplir estrictamente con las siguientes tareas de instalación y configuración:

## 3.1. Instalación y Configuración Base de OpenLDAP

| **ID**       | **Descripción de la Tarea**                         | **Detalles de la Configuración**                                                                |
|--------------|------------------------------------------------------|------------------------------------------------------------------------------------------------|
| T.LDAP.01    | Instalación del servicio OpenLDAP.                   | Se debe mostrar el resultado del comando `slapcat` para validar la instalación base.            |
| T.LDAP.02    | Configuración de la base de datos.                   | Nombre del Dominio: `innovatechXX.test`                                                         |
| T.LDAP.03    | Configuración de la contraseña de administrador.     | Contraseña: `p@ssw0rd`                                                                          |
| T.LDAP.04    | Creación de Unidades Organizativas (OU) iniciales.   | Se deben crear dos OUs: `users` y `groups` mediante un archivo `.ldif`.                         |
| T.LDAP.05    | Validación de las Unidades Organizativas.            | Realizar una consulta con `ldapsearch` que muestre todas las OUs creadas en el directorio.       |

---

## Paso 1: Instalación del servicio OpenLDAP

### Introducción
En este paso instalaremos el **servicio OpenLDAP** en el servidor. Este servicio será la base para la autenticación centralizada y la gestión del directorio dentro del dominio `innovatech10.test`.

---

### Pasos detallados

1. Actualizar los repositorios
Antes de instalar, actualizamos los paquetes del sistema:
```
sudo apt update && sudo apt upgrade -y
```
2. Instalar OpenLDAP y utilidades
Instalamos el servidor LDAP y las herramientas necesarias:
```
sudo apt install slapd ldap-utils -y
```
Durante la instalación, se solicitará:

Contraseña del administrador LDAP (guárdala para los siguientes pasos).
Confirmar la configuración básica del servicio.

3. Reconfigurar el servicio (opcional)
Si necesitas ajustar el dominio o la contraseña del administrador:
```
sudo dpkg-reconfigure slapd
```
Aquí podrás definir:

Dominio base: `innovatech10.test`
Organización: `innovatech10`
Contraseña del administrador LDAP: `p@ssw0rd`

4. Verificar la instalación y estructura del directorio
Para comprobar que el directorio se ha creado correctamente:
```
sudo slapcat
```
Salida esperada:

<img src="img/1.png" alt="Ordenador HP" width="400" height="auto"> 

### Notas importantes

- El comando slapcat muestra el contenido del directorio LDAP en formato LDIF.
- Verifica que el dn (Distinguished Name) coincide con el dominio configurado (dc=innovatech10,dc=test).
- Si la estructura no aparece como esperabas, revisa la configuración con dpkg-reconfigure slapd.
---
## Paso 2 y 3: Configuración de la base de datos y contraseña del administrador

### Introducción
En este paso configuraremos la **base de datos LDAP** y definiremos la **contraseña del administrador** durante la instalación del servicio OpenLDAP. Este proceso asegura que el directorio esté correctamente inicializado con el dominio y la organización deseada.

---

### Pasos detallados

1. Iniciar la configuración interactiva
Si no se realizó durante la instalación, ejecuta:
```
sudo dpkg-reconfigure slapd
```
2. Introducir el nombre de dominio DNS
En la pantalla de configuración (fondo lila), se solicitará el nombre de dominio DNS. Introduce:

<img src="img/1.png" alt="Ordenador HP" width="400" height="auto">

```
innovatech10.test
```

3. Definir el nombre de la organización
En el siguiente paso, introduce:

<img src="img/1.png" alt="Ordenador HP" width="400" height="auto"> 

```
innovatech10.test
```

Pulsa OK para continuar.

4. Establecer la contraseña del administrador LDAP
Cuando se solicite la contraseña del administrador, introduce:

<img src="img/1.png" alt="Ordenador HP" width="400" height="auto"> 

```
p@ssw0rd
```

5. Confirmar opciones adicionales
¿Desea que se borre la base de datos cuando se purgue el paquete slapd?
Selecciona: " YES "

<img src="img/1.png" alt="Ordenador HP" width="400" height="auto"> 

¿Desea mover la base de datos antigua?
Selecciona: " YES "

<img src="img/1.png" alt="Ordenador HP" width="400" height="auto"> 

6. Verificar la configuración
Para comprobar que la base de datos se ha creado correctamente otra vez:
```
sudo slapcat
```
salida esperada:

<img src="img/1.png" alt="Ordenador HP" width="400" height="auto"> 

### Notas importantes

- El comando slapcat muestra el contenido del directorio LDAP en formato LDIF.
- Verifica que el dn coincide con el dominio configurado (dc=innovatech10,dc=test).
- Si la estructura no aparece como esperabas, repite la configuración con dpkg-reconfigure slapd.

---

## Paso 4 y 5: Creación y Validación de Unidades Organizativas (OU)

### Introducción
En este paso crearemos las **Unidades Organizativas (OU)** iniciales en el directorio LDAP y validaremos su correcta creación. Las OUs permiten organizar los objetos del directorio en categorías como usuarios y grupos.

Se crearán dos OUs:
- **users**
- **groups**

---

### Pasos detallados

1. Crear la OU `users`
Abrimos/creamos un archivo LDIF para definir la OU:
```
sudo nano ou_users.ldif
```
Contenido del archivo:

<img src="img/1.png" alt="Ordenador HP" width="400" height="auto"> 

Guarda y cierra el archivo ` (Ctrl+O, Enter, Ctrl+X) `.

2. Añadir la OU users al directorio LDAP
Ejecuta el siguiente comando:
```
ldapadd -D "cn=admin,dc=innovatech10,dc=test" -W -f ou_users.ldif
```
3. Crear la OU groups
Abrimos otro archivo LDIF:
```
sudo nano ou_groups.ldif
```
Contenido del archivo:

<img src="img/1.png" alt="Ordenador HP" width="400" height="auto"> 

Guarda y cierra el archivo ` (Ctrl+O, Enter, Ctrl+X) `.

4. Añadir la OU groups al directorio LDAP
Ejecuta:
```
ldapadd -D "cn=admin,dc=innovatech10,dc=test" -W -f ou_groups.ldif
```
5. Validar las OUs creadas
Para comprobar que las OUs se han creado correctamente:
```
ldapsearch -xLLL -b "dc=innovatech10,dc=test" ou
```
Salida esperada (similar a la captura):

<img src="img/1.png" alt="Ordenador HP" width="400" height="auto"> 

### Notas importantes

- El comando ldapadd requiere la contraseña del administrador LDAP (p@ssw0rd).
- Si aparece un error, revisa que el contenido del archivo LDIF esté correcto y que el dominio coincida con el configurado.
- El comando ldapsearch permite validar la existencia de las OUs en el directorio.

---

## 3.2. Gestión y Administración (LAM)

| **ID**       | **Descripción de la Tarea**                         | **Detalles de la Configuración**                                                                |
|--------------|------------------------------------------------------|------------------------------------------------------------------------------------------------|
| T.LAM.01     | Instalación del Gestor de Usuarios LDAP (LAM).       | Se debe documentar el comando de instalación.                                                   |
| T.LAM.02     | Acceso Remoto y Configuración.                       | Conectar a LAM desde la máquina física utilizando la dirección IP de la interfaz Host-Only.     |
| T.LAM.03     | Configuración por defecto.                           | Establecer la configuración predeterminada para que los nuevos usuarios se ubiquen en la OU `users` y los nuevos grupos en la OU `groups`. |
| T.LAM.04     | Creación de Grupos.                                  | Crear dos grupos de seguridad en el directorio: `tech` y `manager`.                             |
| T.LAM.05     | Creación de Usuarios de Prueba.                      | Crear un usuario para cada grupo: `tech01` (miembro de `tech`) y `manager01` (miembro de `manager`). |

